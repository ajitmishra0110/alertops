<!DOCTYPE html>
<html>
<head>
    <title>AlertOps Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-dark text-white">

<div class="container mt-4">
    <h1 class="text-center">ðŸš¨ AlertOps Dashboard</h1>

    <div class="row mt-4">
        <div class="col-md-4">
            <div class="card bg-secondary text-white p-3">
                <h5>Total Incidents</h5>
                <h2 id="total">0</h2>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card bg-warning text-dark p-3">
                <h5>High Severity</h5>
                <h2 id="high">0</h2>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card bg-success text-white p-3">
                <h5>Status</h5>
                <h2 id="status">OK</h2>
            </div>
        </div>
    </div>

    <canvas id="incidentChart" class="mt-4"></canvas>

    <h3 class="mt-5">Incident List</h3>
    <table class="table table-dark table-striped">
        <thead>
        <tr>
            <th>Service</th>
            <th>Severity</th>
            <th>Message</th>
            <th>Time</th>
        </tr>
        </thead>
        <tbody id="incidentTable"></tbody>
    </table>
</div>

<script>
    async function loadDashboard() {
        const metrics = await fetch('/api/metrics').then(r => r.json());
        const incidents = await fetch('/api/incidents').then(r => r.json());

        document.getElementById('total').innerText = metrics.totalIncidents;
        document.getElementById('high').innerText = metrics.highSeverity;
        document.getElementById('status').innerText = metrics.alert;

        const ctx = document.getElementById('incidentChart');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Total', 'High Severity'],
                datasets: [{
                    label: 'Incident Stats',
                    data: [metrics.totalIncidents, metrics.highSeverity]
                }]
            }
        });

        const table = document.getElementById('incidentTable');
        incidents.forEach(i => {
            table.innerHTML += `
                <tr>
                    <td>${i.service}</td>
                    <td>${i.severity}</td>
                    <td>${i.message}</td>
                    <td>${i.timestamp}</td>
                </tr>`;
        });
    }

    loadDashboard();
</script>

</body>
</html>
